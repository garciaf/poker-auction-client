# Internationalization (i18n) Documentation

This document explains how internationalization is implemented in the Poker Auction Client and how to add new languages or translation keys.

## Overview

The application uses **sveltekit-i18n** for internationalization support. Currently, the application supports:
- ðŸ‡¬ðŸ‡§ English (default)
- ðŸ‡«ðŸ‡· French

User language preferences are persisted in local storage and automatically restored on subsequent visits.

## Project Structure

```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ i18n/
â”‚   â”‚   â”œâ”€â”€ locales/
â”‚   â”‚   â”‚   â”œâ”€â”€ en.json         # English translations
â”‚   â”‚   â”‚   â””â”€â”€ fr.json         # French translations
â”‚   â”‚   â””â”€â”€ index.ts            # i18n configuration
â”‚   â””â”€â”€ stores/
â”‚       â””â”€â”€ locale.ts           # Persisted locale preference store
â””â”€â”€ routes/
    â”œâ”€â”€ +layout.ts              # Loads translations on app init
    â””â”€â”€ +layout.svelte          # Syncs locale with preference store
```

## How It Works

### 1. Translation Files

Translation keys are organized in JSON files under `src/lib/i18n/locales/`:

**en.json** (English):
```json
{
  "common": {
    "lobbyId": "Lobby ID",
    "start": "Start",
    "ready": "Ready"
  },
  "actions": {
    "joinLobby": "Join Lobby",
    "buyNow": "Buy Now"
  }
}
```

**fr.json** (French):
```json
{
  "common": {
    "lobbyId": "ID du Salon",
    "start": "DÃ©marrer",
    "ready": "PrÃªt"
  },
  "actions": {
    "joinLobby": "Rejoindre le Salon",
    "buyNow": "Acheter Maintenant"
  }
}
```

### 2. Using Translations in Components

Import the `t` store from `$lib/i18n` and use the `$t()` function:

```svelte
<script>
  import { t } from '$lib/i18n';
</script>

<button>{$t('actions.joinLobby')}</button>
<input placeholder={$t('placeholders.yourName')} />
```

### 3. Language Switcher

Language switchers are implemented on the home page and lobby page. Users can click flag buttons to switch languages:

```svelte
<script>
  import { localePreference } from '$lib/stores/locale';
  import { availableLocales } from '$lib/i18n';

  function switchLanguage(code) {
    localePreference.set(code);
  }
</script>

{#each availableLocales as { code, flag, name }}
  <button onclick={() => switchLanguage(code)}>
    <span>{flag}</span>
  </button>
{/each}
```

### 4. Persistence

The user's language preference is automatically saved to `localStorage` using `svelte-persisted-store` with the key `poker-auction-locale`.

## Adding a New Language

To add support for a new language (e.g., Spanish):

### Step 1: Create Translation File

Create a new file `src/lib/i18n/locales/es.json`:

```json
{
  "common": {
    "lobbyId": "ID del Lobby",
    "playerName": "Nombre del Jugador",
    "yourName": "Tu nombre",
    "start": "Iniciar",
    "ready": "Listo",
    "loading": "Cargando...",
    "guest": "Invitado"
  },
  "actions": {
    "joinLobby": "Unirse al Lobby",
    "buyNow": "Comprar Ahora",
    "selectCard": "Selecciona una carta para la comunidad",
    "selectJoker": "Selecciona un comodÃ­n para comprar",
    "submitBid": "Enviar Oferta"
  },
  "messages": {
    "welcomeAuction": "Bienvenido a la gran subasta. Por favor elige un nombre antes de unirte al lobby.",
    "gameStartsWhenReady": "El juego comienza cuando todos los jugadores han confirmado"
  },
  "placeholders": {
    "lobbyIdExample": "X12XX",
    "yourName": "Tu nombre",
    "bidAmount": "10"
  },
  "languages": {
    "english": "InglÃ©s",
    "french": "FrancÃ©s",
    "spanish": "EspaÃ±ol"
  }
}
```

### Step 2: Import and Register the Locale

Update `src/lib/i18n/index.ts`:

```typescript
import en from './locales/en.json';
import fr from './locales/fr.json';
import es from './locales/es.json';  // Add this

const config: Config<Translations> = {
  translations: {
    en,
    fr,
    es  // Add this
  },
  loaders: [],
  initLocale: 'en',
  fallbackLocale: 'en'
};

// Update available locales
export const availableLocales = [
  { code: 'en', name: 'English', flag: 'ðŸ‡¬ðŸ‡§' },
  { code: 'fr', name: 'French', flag: 'ðŸ‡«ðŸ‡·' },
  { code: 'es', name: 'Spanish', flag: 'ðŸ‡ªðŸ‡¸' }  // Add this
] as const;

// Update type
export type LocaleCode = 'en' | 'fr' | 'es';  // Add 'es'
```

### Step 3: Update Translations Interface (Optional for TypeScript)

If using TypeScript, update the `Translations` interface in `src/lib/i18n/index.ts` to match your translation structure.

That's it! The new language will automatically appear in the language switcher.

## Adding New Translation Keys

To add new translatable text to the application:

### Step 1: Add Keys to All Locale Files

Add the new key to **all** locale files (en.json, fr.json, etc.):

**en.json:**
```json
{
  "common": {
    "newKey": "New Text in English"
  }
}
```

**fr.json:**
```json
{
  "common": {
    "newKey": "Nouveau texte en franÃ§ais"
  }
}
```

### Step 2: Use in Components

```svelte
<script>
  import { t } from '$lib/i18n';
</script>

<p>{$t('common.newKey')}</p>
```

## Translation Key Naming Convention

Organize translation keys by category:

- `common.*` - Common UI elements (buttons, labels, general terms)
- `actions.*` - Action buttons and interactive elements
- `messages.*` - Messages, descriptions, and longer text
- `placeholders.*` - Input placeholder text
- `languages.*` - Language names for the language switcher

Example:
```
common.lobbyId
actions.joinLobby
messages.welcomeAuction
placeholders.yourName
```

## Important Notes

### Server-Driven Content

Some content in the application (notifications, joker descriptions, loading messages) comes from the server via Socket.IO. These messages are **not translated on the client side**. To translate them:

1. Implement translation on the server side, or
2. Send translation keys from the server instead of final text, or
3. Implement client-side lookup for known server message keys

### Default Values in Stores

Default values in `src/lib/stores/player.ts` (like "Guest" and "Loading...") are initial values that typically get replaced by server data, so they are not translated through the i18n system.

## Testing Translations

1. Start the development server: `npm run dev`
2. Navigate to the home page or lobby page
3. Click the flag buttons in the top-right corner
4. Verify that all text changes to the selected language
5. Refresh the page to confirm language preference persists

## Troubleshooting

### Translations not showing
- Ensure you've imported `{ t }` from `$lib/i18n`
- Check that the translation key exists in all locale files
- Verify the key path is correct (e.g., `common.lobbyId` not `lobbyId`)

### Language not persisting
- Check browser localStorage for the `poker-auction-locale` key
- Ensure `svelte-persisted-store` is working correctly
- Check browser console for errors

### New language not appearing
- Verify the locale file is imported in `src/lib/i18n/index.ts`
- Check that it's added to the `translations` config object
- Ensure it's added to `availableLocales` array
- Update the `LocaleCode` type if using TypeScript

## Resources

- [sveltekit-i18n Documentation](https://github.com/sveltekit-i18n/lib)
- [Svelte Store Documentation](https://svelte.dev/docs#run-time-svelte-store)
- [svelte-persisted-store](https://github.com/joshnuss/svelte-persisted-store)
